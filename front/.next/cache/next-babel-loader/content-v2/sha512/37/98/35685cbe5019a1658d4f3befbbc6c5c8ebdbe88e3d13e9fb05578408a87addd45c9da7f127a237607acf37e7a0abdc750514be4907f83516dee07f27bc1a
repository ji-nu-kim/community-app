{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { MessageOutlined, MoreOutlined } from '@ant-design/icons';\nimport { loadPostsRequestAction } from 'actions/actionPost';\nimport moment from 'moment';\nimport React, { memo, useCallback, useEffect, useState, useRef } from 'react';\nimport dynamic from 'next/dynamic';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { PostContainer } from './styles';\nvar PostSettingModal = dynamic(function () {\n  return import('components/Modals/PostSettingModal');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('components/Modals/PostSettingModal')];\n    },\n    modules: ['components/Modals/PostSettingModal']\n  }\n});\nvar PostEditModal = dynamic(function () {\n  return import('components/Modals/PostEditModal');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('components/Modals/PostEditModal')];\n    },\n    modules: ['components/Modals/PostEditModal']\n  }\n});\nvar CommentSettingModal = dynamic(function () {\n  return import('components/Modals/CommentSettingModal');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('components/Modals/CommentSettingModal')];\n    },\n    modules: ['components/Modals/CommentSettingModal']\n  }\n});\nvar CommentEditModal = dynamic(function () {\n  return import('components/Modals/CommentEditModal');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('components/Modals/CommentEditModal')];\n    },\n    modules: ['components/Modals/CommentEditModal']\n  }\n});\nvar PostForm = dynamic(function () {\n  return import('components/PostForm');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('components/PostForm')];\n    },\n    modules: ['components/PostForm']\n  }\n});\nvar CommentForm = dynamic(function () {\n  return import('components/CommentForm');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('components/CommentForm')];\n    },\n    modules: ['components/CommentForm']\n  }\n});\n\nfunction Post(_ref) {\n  var singleCommunity = _ref.singleCommunity,\n      communityUser = _ref.communityUser;\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(function (state) {\n    return state.post;\n  }),\n      mainPosts = _useSelector.mainPosts,\n      hasMorePost = _useSelector.hasMorePost,\n      loadPostsLoading = _useSelector.loadPostsLoading,\n      updateCommentDone = _useSelector.updateCommentDone;\n\n  var _useState = useState(false),\n      editMode = _useState[0],\n      setEditMode = _useState[1];\n\n  var _useState2 = useState(false),\n      showPostSettingButton = _useState2[0],\n      setShowPostSettingButton = _useState2[1]; // 포스트설정 모달 보여주기\n\n\n  var _useState3 = useState(0),\n      CurrentPostSettingButton = _useState3[0],\n      setCurrentPostSettingButton = _useState3[1]; // 현재 보여지고 있는 포스트설정 모달\n\n\n  var _useState4 = useState(0),\n      currentModifyPost = _useState4[0],\n      setCurrentModifyPost = _useState4[1]; // 현재 수정중인 포스트\n\n\n  var _useState5 = useState(false),\n      showCommentSettingButton = _useState5[0],\n      setShowCommentSettingButton = _useState5[1];\n\n  var _useState6 = useState(0),\n      currentCommentSettingButton = _useState6[0],\n      setCurrentCommentSettingButton = _useState6[1];\n\n  var _useState7 = useState(0),\n      currentModifyComment = _useState7[0],\n      setCurrentModifyComment = _useState7[1];\n\n  var _useState8 = useState(false),\n      openPostCommentForm = _useState8[0],\n      setOpenPostCommentForm = _useState8[1];\n\n  var _useState9 = useState(0),\n      currentPostCommentForm = _useState9[0],\n      setCurrentPostCommentForm = _useState9[1];\n\n  var postContainerRef = useRef(null);\n  var onClickPostSettingButton = useCallback(function (postId) {\n    return function () {\n      setCurrentPostSettingButton(postId);\n      setShowPostSettingButton(true);\n    };\n  }, []);\n  var onClickCommentSettingButton = useCallback(function (commentId) {\n    return function () {\n      setCurrentCommentSettingButton(commentId);\n      setShowCommentSettingButton(true);\n    };\n  }, []);\n  var onTogglePostCommentForm = useCallback(function (postId) {\n    return function () {\n      setCurrentPostCommentForm(postId);\n      setOpenPostCommentForm(function (prev) {\n        return !prev;\n      });\n    };\n  }, []);\n  var onCloseSettingModal = useCallback(function () {\n    if (showPostSettingButton || showCommentSettingButton) {\n      setShowPostSettingButton(false);\n      setShowCommentSettingButton(false);\n    }\n  }, [showPostSettingButton, showCommentSettingButton]);\n  useEffect(function () {\n    if (updateCommentDone) {\n      setEditMode(false);\n    }\n  }, [updateCommentDone]);\n  useEffect(function () {\n    var postContainer = postContainerRef.current;\n    if (!postContainer) return;\n\n    function onScroll(e) {\n      if (communityUser && mainPosts.length) {\n        if (e.target.scrollTop >= e.target.scrollHeight - e.target.offsetHeight - 300) {\n          if (hasMorePost && !loadPostsLoading) {\n            var lastId = mainPosts[mainPosts.length - 1].id;\n            dispatch(loadPostsRequestAction({\n              communityId: singleCommunity.id,\n              postId: lastId\n            }));\n          }\n        }\n      }\n    }\n\n    postContainer.addEventListener('scroll', onScroll);\n    return function () {\n      return postContainer.removeEventListener('scroll', onScroll);\n    };\n  }, [communityUser, mainPosts, hasMorePost, loadPostsLoading, singleCommunity, postContainerRef.current]);\n  return /*#__PURE__*/_jsx(PostContainer, {\n    onClick: onCloseSettingModal,\n    ref: postContainerRef,\n    children: communityUser ? /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"post-form-container\",\n        children: /*#__PURE__*/_jsx(PostForm, {})\n      }), mainPosts.length ? /*#__PURE__*/_jsx(_Fragment, {\n        children: mainPosts.map(function (post) {\n          return /*#__PURE__*/_jsxs(\"div\", {\n            className: \"post-body-container\",\n            children: [editMode && post.id === currentModifyPost && /*#__PURE__*/_jsx(PostEditModal, {\n              setEditMode: setEditMode,\n              setCurrentModifyPost: setCurrentModifyPost,\n              currentPostText: post.content,\n              postId: post.id,\n              communityId: singleCommunity.id\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"header post-body-header\",\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: \"header-left\",\n                children: [/*#__PURE__*/_jsx(\"span\", {\n                  children: post.User.profilePhoto ? /*#__PURE__*/_jsx(\"img\", {\n                    className: \"left-profile-image\",\n                    src: post.User.profilePhoto,\n                    alt: \"profile image\"\n                  }) : /*#__PURE__*/_jsx(\"div\", {\n                    className: \"left-fake-image\",\n                    children: post.User.nickname[0]\n                  })\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"left-nickname\",\n                  children: post.User.nickname\n                })]\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"header-right\",\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: \"right-day\",\n                  children: moment(post.createdAt).locale('ko').format('LLL')\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"right-buttons\",\n                  onClick: onClickPostSettingButton(post.id),\n                  children: /*#__PURE__*/_jsx(MoreOutlined, {})\n                }), showPostSettingButton && post.id === CurrentPostSettingButton && /*#__PURE__*/_jsx(PostSettingModal, {\n                  setCurrentModifyPost: setCurrentModifyPost,\n                  setEditMode: setEditMode,\n                  postId: post.id,\n                  communityId: singleCommunity.id,\n                  postOwnerId: post.User.id,\n                  communityUserId: communityUser.id,\n                  content: post.content\n                })]\n              })]\n            }), post.Images.length ? /*#__PURE__*/_jsx(\"img\", {\n              src: post.Images[0].src.replace(/\\/resize\\//, '/original/'),\n              alt: \"image\",\n              className: \"post-image\"\n            }) : null, /*#__PURE__*/_jsx(\"div\", {\n              className: \"post-text\",\n              children: post.content\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"post-comment-info\",\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                onClick: onTogglePostCommentForm(post.id),\n                style: {\n                  cursor: 'pointer'\n                },\n                children: [/*#__PURE__*/_jsx(\"span\", {\n                  style: {\n                    marginRight: '4px'\n                  },\n                  children: /*#__PURE__*/_jsx(MessageOutlined, {})\n                }), post.Comments.length ? \"\\uB313\\uAE00 \".concat(post.Comments.length, \"\\uAC1C \\uBAA8\\uB450\\uBCF4\\uAE30\") : '댓글 작성하기']\n              }), openPostCommentForm && currentPostCommentForm === post.id && /*#__PURE__*/_jsxs(_Fragment, {\n                children: [post.Comments && post.Comments.map(function (comment) {\n                  return /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"post-comment-container\",\n                    children: [editMode && comment.id === currentModifyComment && /*#__PURE__*/_jsx(CommentEditModal, {\n                      setEditMode: setEditMode,\n                      setCurrentModifyComment: setCurrentModifyComment,\n                      currentCommentText: comment.content,\n                      postId: post.id,\n                      commentId: comment.id\n                    }), /*#__PURE__*/_jsxs(\"div\", {\n                      className: \"header comment-header\",\n                      children: [/*#__PURE__*/_jsxs(\"div\", {\n                        className: \"header-left\",\n                        children: [/*#__PURE__*/_jsx(\"span\", {\n                          children: comment.User.profilePhoto ? /*#__PURE__*/_jsx(\"img\", {\n                            className: \"left-profile-image\",\n                            src: comment.User.profilePhoto,\n                            alt: \"profile image\"\n                          }) : /*#__PURE__*/_jsx(\"div\", {\n                            className: \"left-fake-image\",\n                            children: comment.User.nickname[0]\n                          })\n                        }), /*#__PURE__*/_jsx(\"div\", {\n                          className: \"left-nickname\",\n                          children: comment.User.nickname\n                        })]\n                      }), /*#__PURE__*/_jsxs(\"div\", {\n                        className: \"header-right\",\n                        children: [/*#__PURE__*/_jsx(\"div\", {\n                          className: \"right-day\",\n                          children: moment(comment.createdAt).locale('ko').format('LLL')\n                        }), /*#__PURE__*/_jsx(\"div\", {\n                          className: \"right-buttons\",\n                          onClick: onClickCommentSettingButton(comment.id),\n                          children: /*#__PURE__*/_jsx(MoreOutlined, {})\n                        })]\n                      }), showCommentSettingButton && comment.id === currentCommentSettingButton && /*#__PURE__*/_jsx(CommentSettingModal, {\n                        setCurrentModifyComment: setCurrentModifyComment,\n                        setEditMode: setEditMode,\n                        postId: post.id,\n                        commentId: comment.id,\n                        commentOwnerId: comment.User.id,\n                        communityUserId: communityUser.id,\n                        content: comment.content\n                      })]\n                    }), /*#__PURE__*/_jsx(\"div\", {\n                      className: \"comment-text\",\n                      children: comment.content\n                    })]\n                  }, comment.id);\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"post-comment-form-container\",\n                  children: /*#__PURE__*/_jsx(CommentForm, {\n                    postId: post.id\n                  })\n                })]\n              })]\n            })]\n          }, post.id);\n        })\n      }) : null]\n    }) : /*#__PURE__*/_jsx(\"div\", {\n      className: \"visitor-post\",\n      children: \"\\uCEE4\\uBBA4\\uB2C8\\uD2F0\\uC720\\uC800\\uB9CC \\uBCFC \\uC218 \\uC788\\uC2B5\\uB2C8\\uB2E4\"\n    })\n  });\n}\n\nexport default /*#__PURE__*/memo(Post);","map":{"version":3,"sources":["C:/Users/wlsdn/Desktop/next/community/front/components/CommunityBody/Post/index.tsx"],"names":["MessageOutlined","MoreOutlined","loadPostsRequestAction","moment","React","memo","useCallback","useEffect","useState","useRef","dynamic","useDispatch","useSelector","PostContainer","PostSettingModal","PostEditModal","CommentSettingModal","CommentEditModal","PostForm","CommentForm","Post","singleCommunity","communityUser","dispatch","state","post","mainPosts","hasMorePost","loadPostsLoading","updateCommentDone","editMode","setEditMode","showPostSettingButton","setShowPostSettingButton","CurrentPostSettingButton","setCurrentPostSettingButton","currentModifyPost","setCurrentModifyPost","showCommentSettingButton","setShowCommentSettingButton","currentCommentSettingButton","setCurrentCommentSettingButton","currentModifyComment","setCurrentModifyComment","openPostCommentForm","setOpenPostCommentForm","currentPostCommentForm","setCurrentPostCommentForm","postContainerRef","onClickPostSettingButton","postId","onClickCommentSettingButton","commentId","onTogglePostCommentForm","prev","onCloseSettingModal","postContainer","current","onScroll","e","length","target","scrollTop","scrollHeight","offsetHeight","lastId","id","communityId","addEventListener","removeEventListener","map","content","User","profilePhoto","nickname","createdAt","locale","format","Images","src","replace","cursor","marginRight","Comments","comment"],"mappings":";;;AAAA,SAASA,eAAT,EAA0BC,YAA1B,QAA8C,mBAA9C;AACA,SAASC,sBAAT,QAAuC,oBAAvC;AAGA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,KAAP,IAAgBC,IAAhB,EAAsBC,WAAtB,EAAmCC,SAAnC,EAA8CC,QAA9C,EAAwDC,MAAxD,QAAsE,OAAtE;AACA,OAAOC,OAAP,MAAoB,cAApB;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;AACA,SAASC,aAAT,QAA8B,UAA9B;AAEA,IAAMC,gBAAgB,GAAGJ,OAAO,CAAC;AAAA,SAAM,OAAO,oCAAP,CAAN;AAAA,CAAD;AAAA;AAAA;AAAA,kCAAc,oCAAd;AAAA;AAAA,cAAc,oCAAd;AAAA;AAAA,EAAhC;AACA,IAAMK,aAAa,GAAGL,OAAO,CAAC;AAAA,SAAM,OAAO,iCAAP,CAAN;AAAA,CAAD;AAAA;AAAA;AAAA,kCAAc,iCAAd;AAAA;AAAA,cAAc,iCAAd;AAAA;AAAA,EAA7B;AACA,IAAMM,mBAAmB,GAAGN,OAAO,CACjC;AAAA,SAAM,OAAO,uCAAP,CAAN;AAAA,CADiC;AAAA;AAAA;AAAA,kCACpB,uCADoB;AAAA;AAAA,cACpB,uCADoB;AAAA;AAAA,EAAnC;AAGA,IAAMO,gBAAgB,GAAGP,OAAO,CAAC;AAAA,SAAM,OAAO,oCAAP,CAAN;AAAA,CAAD;AAAA;AAAA;AAAA,kCAAc,oCAAd;AAAA;AAAA,cAAc,oCAAd;AAAA;AAAA,EAAhC;AACA,IAAMQ,QAAQ,GAAGR,OAAO,CAAC;AAAA,SAAM,OAAO,qBAAP,CAAN;AAAA,CAAD;AAAA;AAAA;AAAA,kCAAc,qBAAd;AAAA;AAAA,cAAc,qBAAd;AAAA;AAAA,EAAxB;AACA,IAAMS,WAAW,GAAGT,OAAO,CAAC;AAAA,SAAM,OAAO,wBAAP,CAAN;AAAA,CAAD;AAAA;AAAA;AAAA,kCAAc,wBAAd;AAAA;AAAA,cAAc,wBAAd;AAAA;AAAA,EAA3B;;AAOA,SAASU,IAAT,OAA6D;AAAA,MAA7CC,eAA6C,QAA7CA,eAA6C;AAAA,MAA5BC,aAA4B,QAA5BA,aAA4B;AAC3D,MAAMC,QAAQ,GAAGZ,WAAW,EAA5B;;AAD2D,qBAEaC,WAAW,CACjF,UAACY,KAAD;AAAA,WAA+BA,KAAK,CAACC,IAArC;AAAA,GADiF,CAFxB;AAAA,MAEnDC,SAFmD,gBAEnDA,SAFmD;AAAA,MAExCC,WAFwC,gBAExCA,WAFwC;AAAA,MAE3BC,gBAF2B,gBAE3BA,gBAF2B;AAAA,MAETC,iBAFS,gBAETA,iBAFS;;AAAA,kBAK3BrB,QAAQ,CAAC,KAAD,CALmB;AAAA,MAKpDsB,QALoD;AAAA,MAK1CC,WAL0C;;AAAA,mBAMDvB,QAAQ,CAAC,KAAD,CANP;AAAA,MAMpDwB,qBANoD;AAAA,MAM7BC,wBAN6B,kBAMgB;;;AANhB,mBAOKzB,QAAQ,CAAC,CAAD,CAPb;AAAA,MAOpD0B,wBAPoD;AAAA,MAO1BC,2BAP0B,kBAOkB;;;AAPlB,mBAQT3B,QAAQ,CAAC,CAAD,CARC;AAAA,MAQpD4B,iBARoD;AAAA,MAQjCC,oBARiC,kBAQI;;;AARJ,mBASK7B,QAAQ,CAAC,KAAD,CATb;AAAA,MASpD8B,wBAToD;AAAA,MAS1BC,2BAT0B;;AAAA,mBAUW/B,QAAQ,CAAC,CAAD,CAVnB;AAAA,MAUpDgC,2BAVoD;AAAA,MAUvBC,8BAVuB;;AAAA,mBAWHjC,QAAQ,CAAC,CAAD,CAXL;AAAA,MAWpDkC,oBAXoD;AAAA,MAW9BC,uBAX8B;;AAAA,mBAYLnC,QAAQ,CAAC,KAAD,CAZH;AAAA,MAYpDoC,mBAZoD;AAAA,MAY/BC,sBAZ+B;;AAAA,mBAaCrC,QAAQ,CAAC,CAAD,CAbT;AAAA,MAapDsC,sBAboD;AAAA,MAa5BC,yBAb4B;;AAc3D,MAAMC,gBAAgB,GAAGvC,MAAM,CAAiB,IAAjB,CAA/B;AAEA,MAAMwC,wBAAwB,GAAG3C,WAAW,CAC1C,UAAC4C,MAAD;AAAA,WAAoB,YAAM;AACxBf,MAAAA,2BAA2B,CAACe,MAAD,CAA3B;AACAjB,MAAAA,wBAAwB,CAAC,IAAD,CAAxB;AACD,KAHD;AAAA,GAD0C,EAK1C,EAL0C,CAA5C;AAQA,MAAMkB,2BAA2B,GAAG7C,WAAW,CAC7C,UAAC8C,SAAD;AAAA,WAAuB,YAAM;AAC3BX,MAAAA,8BAA8B,CAACW,SAAD,CAA9B;AACAb,MAAAA,2BAA2B,CAAC,IAAD,CAA3B;AACD,KAHD;AAAA,GAD6C,EAK7C,EAL6C,CAA/C;AAQA,MAAMc,uBAAuB,GAAG/C,WAAW,CACzC,UAAC4C,MAAD;AAAA,WAAoB,YAAM;AACxBH,MAAAA,yBAAyB,CAACG,MAAD,CAAzB;AACAL,MAAAA,sBAAsB,CAAC,UAAAS,IAAI;AAAA,eAAI,CAACA,IAAL;AAAA,OAAL,CAAtB;AACD,KAHD;AAAA,GADyC,EAKzC,EALyC,CAA3C;AAQA,MAAMC,mBAAmB,GAAGjD,WAAW,CAAC,YAAM;AAC5C,QAAI0B,qBAAqB,IAAIM,wBAA7B,EAAuD;AACrDL,MAAAA,wBAAwB,CAAC,KAAD,CAAxB;AACAM,MAAAA,2BAA2B,CAAC,KAAD,CAA3B;AACD;AACF,GALsC,EAKpC,CAACP,qBAAD,EAAwBM,wBAAxB,CALoC,CAAvC;AAOA/B,EAAAA,SAAS,CAAC,YAAM;AACd,QAAIsB,iBAAJ,EAAuB;AACrBE,MAAAA,WAAW,CAAC,KAAD,CAAX;AACD;AACF,GAJQ,EAIN,CAACF,iBAAD,CAJM,CAAT;AAMAtB,EAAAA,SAAS,CAAC,YAAM;AACd,QAAMiD,aAAa,GAAGR,gBAAgB,CAACS,OAAvC;AACA,QAAI,CAACD,aAAL,EAAoB;;AAEpB,aAASE,QAAT,CAAkBC,CAAlB,EAA0B;AACxB,UAAIrC,aAAa,IAAII,SAAS,CAACkC,MAA/B,EAAuC;AACrC,YAAID,CAAC,CAACE,MAAF,CAASC,SAAT,IAAsBH,CAAC,CAACE,MAAF,CAASE,YAAT,GAAwBJ,CAAC,CAACE,MAAF,CAASG,YAAjC,GAAgD,GAA1E,EAA+E;AAC7E,cAAIrC,WAAW,IAAI,CAACC,gBAApB,EAAsC;AACpC,gBAAMqC,MAAM,GAAGvC,SAAS,CAACA,SAAS,CAACkC,MAAV,GAAmB,CAApB,CAAT,CAAgCM,EAA/C;AACA3C,YAAAA,QAAQ,CACNrB,sBAAsB,CAAC;AAAEiE,cAAAA,WAAW,EAAE9C,eAAe,CAAC6C,EAA/B;AAAmChB,cAAAA,MAAM,EAAEe;AAA3C,aAAD,CADhB,CAAR;AAGD;AACF;AACF;AACF;;AAEDT,IAAAA,aAAa,CAACY,gBAAd,CAA+B,QAA/B,EAAyCV,QAAzC;AAEA,WAAO;AAAA,aAAMF,aAAa,CAACa,mBAAd,CAAkC,QAAlC,EAA4CX,QAA5C,CAAN;AAAA,KAAP;AACD,GApBQ,EAoBN,CACDpC,aADC,EAEDI,SAFC,EAGDC,WAHC,EAIDC,gBAJC,EAKDP,eALC,EAMD2B,gBAAgB,CAACS,OANhB,CApBM,CAAT;AA6BA,sBACE,KAAC,aAAD;AAAe,IAAA,OAAO,EAAEF,mBAAxB;AAA6C,IAAA,GAAG,EAAEP,gBAAlD;AAAA,cACG1B,aAAa,gBACZ;AAAA,8BACE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA,+BACE,KAAC,QAAD;AADF,QADF,EAIGI,SAAS,CAACkC,MAAV,gBACC;AAAA,kBACGlC,SAAS,CAAC4C,GAAV,CAAc,UAAA7C,IAAI;AAAA,8BACjB;AAAK,YAAA,SAAS,EAAC,qBAAf;AAAA,uBACGK,QAAQ,IAAIL,IAAI,CAACyC,EAAL,KAAY9B,iBAAxB,iBACC,KAAC,aAAD;AACE,cAAA,WAAW,EAAEL,WADf;AAEE,cAAA,oBAAoB,EAAEM,oBAFxB;AAGE,cAAA,eAAe,EAAEZ,IAAI,CAAC8C,OAHxB;AAIE,cAAA,MAAM,EAAE9C,IAAI,CAACyC,EAJf;AAKE,cAAA,WAAW,EAAE7C,eAAe,CAAC6C;AAL/B,cAFJ,eAUE;AAAK,cAAA,SAAS,EAAC,yBAAf;AAAA,sCACE;AAAK,gBAAA,SAAS,EAAC,aAAf;AAAA,wCACE;AAAA,4BACGzC,IAAI,CAAC+C,IAAL,CAAUC,YAAV,gBACC;AACE,oBAAA,SAAS,EAAC,oBADZ;AAEE,oBAAA,GAAG,EAAEhD,IAAI,CAAC+C,IAAL,CAAUC,YAFjB;AAGE,oBAAA,GAAG,EAAC;AAHN,oBADD,gBAOC;AAAK,oBAAA,SAAS,EAAC,iBAAf;AAAA,8BAAkChD,IAAI,CAAC+C,IAAL,CAAUE,QAAV,CAAmB,CAAnB;AAAlC;AARJ,kBADF,eAYE;AAAK,kBAAA,SAAS,EAAC,eAAf;AAAA,4BAAgCjD,IAAI,CAAC+C,IAAL,CAAUE;AAA1C,kBAZF;AAAA,gBADF,eAeE;AAAK,gBAAA,SAAS,EAAC,cAAf;AAAA,wCACE;AAAK,kBAAA,SAAS,EAAC,WAAf;AAAA,4BACGvE,MAAM,CAACsB,IAAI,CAACkD,SAAN,CAAN,CAAuBC,MAAvB,CAA8B,IAA9B,EAAoCC,MAApC,CAA2C,KAA3C;AADH,kBADF,eAIE;AACE,kBAAA,SAAS,EAAC,eADZ;AAEE,kBAAA,OAAO,EAAE5B,wBAAwB,CAACxB,IAAI,CAACyC,EAAN,CAFnC;AAAA,yCAIE,KAAC,YAAD;AAJF,kBAJF,EAUGlC,qBAAqB,IAAIP,IAAI,CAACyC,EAAL,KAAYhC,wBAArC,iBACC,KAAC,gBAAD;AACE,kBAAA,oBAAoB,EAAEG,oBADxB;AAEE,kBAAA,WAAW,EAAEN,WAFf;AAGE,kBAAA,MAAM,EAAEN,IAAI,CAACyC,EAHf;AAIE,kBAAA,WAAW,EAAE7C,eAAe,CAAC6C,EAJ/B;AAKE,kBAAA,WAAW,EAAEzC,IAAI,CAAC+C,IAAL,CAAUN,EALzB;AAME,kBAAA,eAAe,EAAE5C,aAAa,CAAC4C,EANjC;AAOE,kBAAA,OAAO,EAAEzC,IAAI,CAAC8C;AAPhB,kBAXJ;AAAA,gBAfF;AAAA,cAVF,EAgDG9C,IAAI,CAACqD,MAAL,CAAYlB,MAAZ,gBACC;AACE,cAAA,GAAG,EAAEnC,IAAI,CAACqD,MAAL,CAAY,CAAZ,EAAeC,GAAf,CAAmBC,OAAnB,CAA2B,YAA3B,EAAyC,YAAzC,CADP;AAEE,cAAA,GAAG,EAAC,OAFN;AAGE,cAAA,SAAS,EAAC;AAHZ,cADD,GAMG,IAtDN,eAuDE;AAAK,cAAA,SAAS,EAAC,WAAf;AAAA,wBAA4BvD,IAAI,CAAC8C;AAAjC,cAvDF,eAwDE;AAAK,cAAA,SAAS,EAAC,mBAAf;AAAA,sCACE;AACE,gBAAA,OAAO,EAAElB,uBAAuB,CAAC5B,IAAI,CAACyC,EAAN,CADlC;AAEE,gBAAA,KAAK,EAAE;AACLe,kBAAAA,MAAM,EAAE;AADH,iBAFT;AAAA,wCAME;AAAM,kBAAA,KAAK,EAAE;AAAEC,oBAAAA,WAAW,EAAE;AAAf,mBAAb;AAAA,yCACE,KAAC,eAAD;AADF,kBANF,EASGzD,IAAI,CAAC0D,QAAL,CAAcvB,MAAd,0BACSnC,IAAI,CAAC0D,QAAL,CAAcvB,MADvB,uCAEG,SAXN;AAAA,gBADF,EAcGhB,mBAAmB,IAAIE,sBAAsB,KAAKrB,IAAI,CAACyC,EAAvD,iBACC;AAAA,2BACGzC,IAAI,CAAC0D,QAAL,IACC1D,IAAI,CAAC0D,QAAL,CAAcb,GAAd,CAAkB,UAAAc,OAAO;AAAA,sCACvB;AAAK,oBAAA,SAAS,EAAC,wBAAf;AAAA,+BACGtD,QAAQ,IAAIsD,OAAO,CAAClB,EAAR,KAAexB,oBAA3B,iBACC,KAAC,gBAAD;AACE,sBAAA,WAAW,EAAEX,WADf;AAEE,sBAAA,uBAAuB,EAAEY,uBAF3B;AAGE,sBAAA,kBAAkB,EAAEyC,OAAO,CAACb,OAH9B;AAIE,sBAAA,MAAM,EAAE9C,IAAI,CAACyC,EAJf;AAKE,sBAAA,SAAS,EAAEkB,OAAO,CAAClB;AALrB,sBAFJ,eAUE;AAAK,sBAAA,SAAS,EAAC,uBAAf;AAAA,8CACE;AAAK,wBAAA,SAAS,EAAC,aAAf;AAAA,gDACE;AAAA,oCACGkB,OAAO,CAACZ,IAAR,CAAaC,YAAb,gBACC;AACE,4BAAA,SAAS,EAAC,oBADZ;AAEE,4BAAA,GAAG,EAAEW,OAAO,CAACZ,IAAR,CAAaC,YAFpB;AAGE,4BAAA,GAAG,EAAC;AAHN,4BADD,gBAOC;AAAK,4BAAA,SAAS,EAAC,iBAAf;AAAA,sCACGW,OAAO,CAACZ,IAAR,CAAaE,QAAb,CAAsB,CAAtB;AADH;AARJ,0BADF,eAcE;AAAK,0BAAA,SAAS,EAAC,eAAf;AAAA,oCACGU,OAAO,CAACZ,IAAR,CAAaE;AADhB,0BAdF;AAAA,wBADF,eAmBE;AAAK,wBAAA,SAAS,EAAC,cAAf;AAAA,gDACE;AAAK,0BAAA,SAAS,EAAC,WAAf;AAAA,oCACGvE,MAAM,CAACiF,OAAO,CAACT,SAAT,CAAN,CAA0BC,MAA1B,CAAiC,IAAjC,EAAuCC,MAAvC,CAA8C,KAA9C;AADH,0BADF,eAIE;AACE,0BAAA,SAAS,EAAC,eADZ;AAEE,0BAAA,OAAO,EAAE1B,2BAA2B,CAACiC,OAAO,CAAClB,EAAT,CAFtC;AAAA,iDAIE,KAAC,YAAD;AAJF,0BAJF;AAAA,wBAnBF,EA8BG5B,wBAAwB,IACvB8C,OAAO,CAAClB,EAAR,KAAe1B,2BADhB,iBAEG,KAAC,mBAAD;AACE,wBAAA,uBAAuB,EAAEG,uBAD3B;AAEE,wBAAA,WAAW,EAAEZ,WAFf;AAGE,wBAAA,MAAM,EAAEN,IAAI,CAACyC,EAHf;AAIE,wBAAA,SAAS,EAAEkB,OAAO,CAAClB,EAJrB;AAKE,wBAAA,cAAc,EAAEkB,OAAO,CAACZ,IAAR,CAAaN,EAL/B;AAME,wBAAA,eAAe,EAAE5C,aAAa,CAAC4C,EANjC;AAOE,wBAAA,OAAO,EAAEkB,OAAO,CAACb;AAPnB,wBAhCN;AAAA,sBAVF,eAqDE;AAAK,sBAAA,SAAS,EAAC,cAAf;AAAA,gCAA+Ba,OAAO,CAACb;AAAvC,sBArDF;AAAA,qBAA6Ca,OAAO,CAAClB,EAArD,CADuB;AAAA,iBAAzB,CAFJ,eA2DE;AAAK,kBAAA,SAAS,EAAC,6BAAf;AAAA,yCACE,KAAC,WAAD;AAAa,oBAAA,MAAM,EAAEzC,IAAI,CAACyC;AAA1B;AADF,kBA3DF;AAAA,gBAfJ;AAAA,cAxDF;AAAA,aAA0CzC,IAAI,CAACyC,EAA/C,CADiB;AAAA,SAAlB;AADH,QADD,GA8IG,IAlJN;AAAA,MADY,gBAsJZ;AAAK,MAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAvJJ,IADF;AA4JD;;AAED,4BAAe7D,IAAI,CAACe,IAAD,CAAnB","sourcesContent":["import { MessageOutlined, MoreOutlined } from '@ant-design/icons';\nimport { loadPostsRequestAction } from 'actions/actionPost';\nimport { ICommunity, IUserInfo } from 'interfaces/db';\nimport { RootStateInterface } from 'interfaces/RootState';\nimport moment from 'moment';\nimport React, { memo, useCallback, useEffect, useState, useRef } from 'react';\nimport dynamic from 'next/dynamic';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { PostContainer } from './styles';\n\nconst PostSettingModal = dynamic(() => import('components/Modals/PostSettingModal'));\nconst PostEditModal = dynamic(() => import('components/Modals/PostEditModal'));\nconst CommentSettingModal = dynamic(\n  () => import('components/Modals/CommentSettingModal')\n);\nconst CommentEditModal = dynamic(() => import('components/Modals/CommentEditModal'));\nconst PostForm = dynamic(() => import('components/PostForm'));\nconst CommentForm = dynamic(() => import('components/CommentForm'));\n\ninterface PostProps {\n  singleCommunity: ICommunity;\n  communityUser: IUserInfo | undefined;\n}\n\nfunction Post({ singleCommunity, communityUser }: PostProps) {\n  const dispatch = useDispatch();\n  const { mainPosts, hasMorePost, loadPostsLoading, updateCommentDone } = useSelector(\n    (state: RootStateInterface) => state.post\n  );\n  const [editMode, setEditMode] = useState(false);\n  const [showPostSettingButton, setShowPostSettingButton] = useState(false); // 포스트설정 모달 보여주기\n  const [CurrentPostSettingButton, setCurrentPostSettingButton] = useState(0); // 현재 보여지고 있는 포스트설정 모달\n  const [currentModifyPost, setCurrentModifyPost] = useState(0); // 현재 수정중인 포스트\n  const [showCommentSettingButton, setShowCommentSettingButton] = useState(false);\n  const [currentCommentSettingButton, setCurrentCommentSettingButton] = useState(0);\n  const [currentModifyComment, setCurrentModifyComment] = useState(0);\n  const [openPostCommentForm, setOpenPostCommentForm] = useState(false);\n  const [currentPostCommentForm, setCurrentPostCommentForm] = useState(0);\n  const postContainerRef = useRef<HTMLDivElement>(null);\n\n  const onClickPostSettingButton = useCallback(\n    (postId: number) => () => {\n      setCurrentPostSettingButton(postId);\n      setShowPostSettingButton(true);\n    },\n    []\n  );\n\n  const onClickCommentSettingButton = useCallback(\n    (commentId: number) => () => {\n      setCurrentCommentSettingButton(commentId);\n      setShowCommentSettingButton(true);\n    },\n    []\n  );\n\n  const onTogglePostCommentForm = useCallback(\n    (postId: number) => () => {\n      setCurrentPostCommentForm(postId);\n      setOpenPostCommentForm(prev => !prev);\n    },\n    []\n  );\n\n  const onCloseSettingModal = useCallback(() => {\n    if (showPostSettingButton || showCommentSettingButton) {\n      setShowPostSettingButton(false);\n      setShowCommentSettingButton(false);\n    }\n  }, [showPostSettingButton, showCommentSettingButton]);\n\n  useEffect(() => {\n    if (updateCommentDone) {\n      setEditMode(false);\n    }\n  }, [updateCommentDone]);\n\n  useEffect(() => {\n    const postContainer = postContainerRef.current;\n    if (!postContainer) return;\n\n    function onScroll(e: any) {\n      if (communityUser && mainPosts.length) {\n        if (e.target.scrollTop >= e.target.scrollHeight - e.target.offsetHeight - 300) {\n          if (hasMorePost && !loadPostsLoading) {\n            const lastId = mainPosts[mainPosts.length - 1].id;\n            dispatch(\n              loadPostsRequestAction({ communityId: singleCommunity.id, postId: lastId })\n            );\n          }\n        }\n      }\n    }\n\n    postContainer.addEventListener('scroll', onScroll);\n\n    return () => postContainer.removeEventListener('scroll', onScroll);\n  }, [\n    communityUser,\n    mainPosts,\n    hasMorePost,\n    loadPostsLoading,\n    singleCommunity,\n    postContainerRef.current,\n  ]);\n\n  return (\n    <PostContainer onClick={onCloseSettingModal} ref={postContainerRef}>\n      {communityUser ? (\n        <>\n          <div className=\"post-form-container\">\n            <PostForm />\n          </div>\n          {mainPosts.length ? (\n            <>\n              {mainPosts.map(post => (\n                <div className=\"post-body-container\" key={post.id}>\n                  {editMode && post.id === currentModifyPost && (\n                    <PostEditModal\n                      setEditMode={setEditMode}\n                      setCurrentModifyPost={setCurrentModifyPost}\n                      currentPostText={post.content}\n                      postId={post.id}\n                      communityId={singleCommunity.id}\n                    />\n                  )}\n                  <div className=\"header post-body-header\">\n                    <div className=\"header-left\">\n                      <span>\n                        {post.User.profilePhoto ? (\n                          <img\n                            className=\"left-profile-image\"\n                            src={post.User.profilePhoto}\n                            alt=\"profile image\"\n                          />\n                        ) : (\n                          <div className=\"left-fake-image\">{post.User.nickname[0]}</div>\n                        )}\n                      </span>\n                      <div className=\"left-nickname\">{post.User.nickname}</div>\n                    </div>\n                    <div className=\"header-right\">\n                      <div className=\"right-day\">\n                        {moment(post.createdAt).locale('ko').format('LLL')}\n                      </div>\n                      <div\n                        className=\"right-buttons\"\n                        onClick={onClickPostSettingButton(post.id)}\n                      >\n                        <MoreOutlined />\n                      </div>\n                      {showPostSettingButton && post.id === CurrentPostSettingButton && (\n                        <PostSettingModal\n                          setCurrentModifyPost={setCurrentModifyPost}\n                          setEditMode={setEditMode}\n                          postId={post.id}\n                          communityId={singleCommunity.id}\n                          postOwnerId={post.User.id}\n                          communityUserId={communityUser.id}\n                          content={post.content}\n                        />\n                      )}\n                    </div>\n                  </div>\n                  {post.Images.length ? (\n                    <img\n                      src={post.Images[0].src.replace(/\\/resize\\//, '/original/')}\n                      alt=\"image\"\n                      className=\"post-image\"\n                    />\n                  ) : null}\n                  <div className=\"post-text\">{post.content}</div>\n                  <div className=\"post-comment-info\">\n                    <div\n                      onClick={onTogglePostCommentForm(post.id)}\n                      style={{\n                        cursor: 'pointer',\n                      }}\n                    >\n                      <span style={{ marginRight: '4px' }}>\n                        <MessageOutlined />\n                      </span>\n                      {post.Comments.length\n                        ? `댓글 ${post.Comments.length}개 모두보기`\n                        : '댓글 작성하기'}\n                    </div>\n                    {openPostCommentForm && currentPostCommentForm === post.id && (\n                      <>\n                        {post.Comments &&\n                          post.Comments.map(comment => (\n                            <div className=\"post-comment-container\" key={comment.id}>\n                              {editMode && comment.id === currentModifyComment && (\n                                <CommentEditModal\n                                  setEditMode={setEditMode}\n                                  setCurrentModifyComment={setCurrentModifyComment}\n                                  currentCommentText={comment.content}\n                                  postId={post.id}\n                                  commentId={comment.id}\n                                />\n                              )}\n                              <div className=\"header comment-header\">\n                                <div className=\"header-left\">\n                                  <span>\n                                    {comment.User.profilePhoto ? (\n                                      <img\n                                        className=\"left-profile-image\"\n                                        src={comment.User.profilePhoto}\n                                        alt=\"profile image\"\n                                      />\n                                    ) : (\n                                      <div className=\"left-fake-image\">\n                                        {comment.User.nickname[0]}\n                                      </div>\n                                    )}\n                                  </span>\n                                  <div className=\"left-nickname\">\n                                    {comment.User.nickname}\n                                  </div>\n                                </div>\n                                <div className=\"header-right\">\n                                  <div className=\"right-day\">\n                                    {moment(comment.createdAt).locale('ko').format('LLL')}\n                                  </div>\n                                  <div\n                                    className=\"right-buttons\"\n                                    onClick={onClickCommentSettingButton(comment.id)}\n                                  >\n                                    <MoreOutlined />\n                                  </div>\n                                </div>\n                                {showCommentSettingButton &&\n                                  comment.id === currentCommentSettingButton && (\n                                    <CommentSettingModal\n                                      setCurrentModifyComment={setCurrentModifyComment}\n                                      setEditMode={setEditMode}\n                                      postId={post.id}\n                                      commentId={comment.id}\n                                      commentOwnerId={comment.User.id}\n                                      communityUserId={communityUser.id}\n                                      content={comment.content}\n                                    />\n                                  )}\n                              </div>\n                              <div className=\"comment-text\">{comment.content}</div>\n                            </div>\n                          ))}\n                        <div className=\"post-comment-form-container\">\n                          <CommentForm postId={post.id} />\n                        </div>\n                      </>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </>\n          ) : null}\n        </>\n      ) : (\n        <div className=\"visitor-post\">커뮤니티유저만 볼 수 있습니다</div>\n      )}\n    </PostContainer>\n  );\n}\n\nexport default memo(Post);\n"]},"metadata":{},"sourceType":"module"}