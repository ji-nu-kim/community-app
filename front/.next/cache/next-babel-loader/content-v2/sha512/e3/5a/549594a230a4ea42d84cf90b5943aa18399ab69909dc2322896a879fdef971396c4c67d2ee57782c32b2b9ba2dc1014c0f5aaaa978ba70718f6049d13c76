{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport AppLayout from '../components/Layouts/AppLayout';\nimport React, { memo, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { END } from 'redux-saga';\nimport axios from 'axios';\nimport { loadMyInfoRequestAction } from 'actions/actionUser';\nimport { loadCommunitiesRequestAction, loadCountryCommunitiesRequestAction } from 'actions/actionCommunity';\nimport wrapper from 'store/configureStore';\nimport BoxStyleCard from 'components/Cards/BoxStyleCard';\nimport HomeLayout from 'components/Layouts/HomeLayout';\nimport Link from 'next/link';\n\nfunction Home() {\n  const dispatch = useDispatch();\n  const {\n    me\n  } = useSelector(state => state.user);\n  const {\n    mainCommunities,\n    changableCommunities,\n    hasMoreCommunity,\n    loadCommunitiesLoading\n  } = useSelector(state => state.community);\n  useEffect(() => {\n    if (me !== null && me !== void 0 && me.country) {\n      dispatch(loadCountryCommunitiesRequestAction({\n        country: me.country,\n        communityId: 0\n      }));\n    }\n  }, [me === null || me === void 0 ? void 0 : me.country]);\n  useEffect(() => {\n    function onScroll() {\n      if (me !== null && me !== void 0 && me.country && changableCommunities.length) {\n        console.log(1);\n\n        if (window.scrollY + document.documentElement.clientHeight >= document.documentElement.scrollHeight - 200) {\n          console.log(2);\n\n          if (hasMoreCommunity && !loadCommunitiesLoading) {\n            console.log(3);\n            const lastId = changableCommunities[changableCommunities.length - 1].id;\n            dispatch(loadCountryCommunitiesRequestAction({\n              country: me.country,\n              communityId: lastId\n            }));\n          }\n        }\n      }\n    }\n\n    window.addEventListener('scroll', onScroll);\n    return () => window.removeEventListener('scroll', onScroll);\n  }, [hasMoreCommunity, loadCommunitiesLoading, changableCommunities, me]);\n  return /*#__PURE__*/_jsx(AppLayout, {\n    children: /*#__PURE__*/_jsxs(HomeLayout, {\n      children: [/*#__PURE__*/_jsxs(\"section\", {\n        children: [/*#__PURE__*/_jsx(\"h1\", {\n          children: \"\\uC0C8\\uB85C\\uC6B4 \\uCEE4\\uBBA4\\uB2C8\\uD2F0\\uB97C \\uB9CC\\uB098\\uBCF4\\uC138\\uC694\"\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"cards-container\",\n          children: mainCommunities.map(community => /*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(Link, {\n              href: `/community/${community.id}`,\n              children: /*#__PURE__*/_jsx(\"a\", {\n                children: /*#__PURE__*/_jsx(BoxStyleCard, {\n                  profilePhoto: community.profilePhoto,\n                  categoryName: community.Categories[0].name,\n                  country: community.country,\n                  communityName: community.communityName\n                })\n              })\n            })\n          }, `new${community.id}`))\n        })]\n      }), me && changableCommunities && /*#__PURE__*/_jsxs(\"section\", {\n        children: [/*#__PURE__*/_jsx(\"h1\", {\n          children: \"\\uC6B0\\uB9AC\\uB3D9\\uB124 \\uCEE4\\uBBA4\\uB2C8\\uD2F0\"\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"cards-container\",\n          children: changableCommunities.map(community => /*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(Link, {\n              href: `/community/${community.id}`,\n              children: /*#__PURE__*/_jsx(\"a\", {\n                children: /*#__PURE__*/_jsx(BoxStyleCard, {\n                  profilePhoto: community.profilePhoto,\n                  categoryName: community.Categories[0].name,\n                  country: community.country,\n                  communityName: community.communityName\n                })\n              })\n            })\n          }, `country${community.id}`))\n        })]\n      })]\n    })\n  });\n}\n\nexport const getServerSideProps = wrapper.getServerSideProps(async context => {\n  const cookie = context.req ? context.req.headers.cookie : '';\n  axios.defaults.headers.Cookie = '';\n\n  if (context.req && cookie) {\n    axios.defaults.headers.Cookie = cookie;\n  }\n\n  context.store.dispatch(loadMyInfoRequestAction());\n  context.store.dispatch(loadCommunitiesRequestAction());\n  context.store.dispatch(END);\n  await context.store.sagaTask.toPromise();\n});\nexport default /*#__PURE__*/memo(Home);","map":{"version":3,"sources":["C:/Users/wlsdn/Desktop/next/community/front/pages/index.tsx"],"names":["AppLayout","React","memo","useEffect","useDispatch","useSelector","END","axios","loadMyInfoRequestAction","loadCommunitiesRequestAction","loadCountryCommunitiesRequestAction","wrapper","BoxStyleCard","HomeLayout","Link","Home","dispatch","me","state","user","mainCommunities","changableCommunities","hasMoreCommunity","loadCommunitiesLoading","community","country","communityId","onScroll","length","console","log","window","scrollY","document","documentElement","clientHeight","scrollHeight","lastId","id","addEventListener","removeEventListener","map","profilePhoto","Categories","name","communityName","getServerSideProps","context","cookie","req","headers","defaults","Cookie","store","sagaTask","toPromise"],"mappings":"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","sourcesContent":["import AppLayout from '../components/Layouts/AppLayout';\nimport React, { memo, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { END } from 'redux-saga';\nimport axios from 'axios';\nimport { RootStateInterface } from '../interfaces/RootState';\nimport { loadMyInfoRequestAction } from 'actions/actionUser';\nimport {\n  loadCommunitiesRequestAction,\n  loadCountryCommunitiesRequestAction,\n} from 'actions/actionCommunity';\nimport wrapper from 'store/configureStore';\nimport { GetServerSideProps } from 'next';\nimport BoxStyleCard from 'components/Cards/BoxStyleCard';\nimport HomeLayout from 'components/Layouts/HomeLayout';\nimport Link from 'next/link';\n\nfunction Home() {\n  const dispatch = useDispatch();\n  const { me } = useSelector((state: RootStateInterface) => state.user);\n  const {\n    mainCommunities,\n    changableCommunities,\n    hasMoreCommunity,\n    loadCommunitiesLoading,\n  } = useSelector((state: RootStateInterface) => state.community);\n\n  useEffect(() => {\n    if (me?.country) {\n      dispatch(\n        loadCountryCommunitiesRequestAction({\n          country: me.country,\n          communityId: 0,\n        })\n      );\n    }\n  }, [me?.country]);\n\n  useEffect(() => {\n    function onScroll() {\n      if (me?.country && changableCommunities.length) {\n        console.log(1);\n        if (\n          window.scrollY + document.documentElement.clientHeight >=\n          document.documentElement.scrollHeight - 200\n        ) {\n          console.log(2);\n          if (hasMoreCommunity && !loadCommunitiesLoading) {\n            console.log(3);\n            const lastId = changableCommunities[changableCommunities.length - 1].id;\n            dispatch(\n              loadCountryCommunitiesRequestAction({\n                country: me.country,\n                communityId: lastId,\n              })\n            );\n          }\n        }\n      }\n    }\n    window.addEventListener('scroll', onScroll);\n\n    return () => window.removeEventListener('scroll', onScroll);\n  }, [hasMoreCommunity, loadCommunitiesLoading, changableCommunities, me]);\n\n  return (\n    <AppLayout>\n      <HomeLayout>\n        {/* 유저정보가 없어도 보여지는 카드 */}\n        <section>\n          <h1>새로운 커뮤니티를 만나보세요</h1>\n          <div className=\"cards-container\">\n            {mainCommunities.map(community => (\n              <div key={`new${community.id}`}>\n                <Link href={`/community/${community.id}`}>\n                  <a>\n                    <BoxStyleCard\n                      profilePhoto={community.profilePhoto}\n                      categoryName={community.Categories[0].name}\n                      country={community.country}\n                      communityName={community.communityName}\n                    />\n                  </a>\n                </Link>\n              </div>\n            ))}\n          </div>\n        </section>\n\n        {/* 유저정보가 있을 때 보여지는 카드  */}\n        {me && changableCommunities && (\n          <section>\n            <h1>우리동네 커뮤니티</h1>\n            <div className=\"cards-container\">\n              {changableCommunities.map(community => (\n                <div key={`country${community.id}`}>\n                  <Link href={`/community/${community.id}`}>\n                    <a>\n                      <BoxStyleCard\n                        profilePhoto={community.profilePhoto}\n                        categoryName={community.Categories[0].name}\n                        country={community.country}\n                        communityName={community.communityName}\n                      />\n                    </a>\n                  </Link>\n                </div>\n              ))}\n            </div>\n          </section>\n        )}\n      </HomeLayout>\n    </AppLayout>\n  );\n}\n\nexport const getServerSideProps: GetServerSideProps = wrapper.getServerSideProps(\n  async context => {\n    const cookie = context.req ? context.req.headers.cookie : '';\n    axios.defaults.headers.Cookie = '';\n    if (context.req && cookie) {\n      axios.defaults.headers.Cookie = cookie;\n    }\n    context.store.dispatch(loadMyInfoRequestAction());\n    context.store.dispatch(loadCommunitiesRequestAction());\n    context.store.dispatch(END);\n    await context.store.sagaTask.toPromise();\n  }\n);\n\nexport default memo(Home);\n"]},"metadata":{},"sourceType":"module"}