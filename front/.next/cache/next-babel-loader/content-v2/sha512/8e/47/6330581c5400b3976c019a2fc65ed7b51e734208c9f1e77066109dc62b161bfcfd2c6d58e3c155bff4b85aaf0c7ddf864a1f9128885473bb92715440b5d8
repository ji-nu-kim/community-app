{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { MessageOutlined, MoreOutlined } from '@ant-design/icons';\nimport { loadPostsRequestAction } from 'actions/actionPost';\nimport moment from 'moment';\nimport React, { memo, useCallback, useEffect, useState, useRef } from 'react';\nimport dynamic from 'next/dynamic';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { PostContainer } from './styles';\nconst PostSettingModal = dynamic(() => import('components/Modals/PostSettingModal'), {\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('components/Modals/PostSettingModal')],\n    modules: ['components/Modals/PostSettingModal']\n  }\n});\nconst PostEditModal = dynamic(() => import('components/Modals/PostEditModal'), {\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('components/Modals/PostEditModal')],\n    modules: ['components/Modals/PostEditModal']\n  }\n});\nconst CommentSettingModal = dynamic(() => import('components/Modals/CommentSettingModal'), {\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('components/Modals/CommentSettingModal')],\n    modules: ['components/Modals/CommentSettingModal']\n  }\n});\nconst CommentEditModal = dynamic(() => import('components/Modals/CommentEditModal'), {\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('components/Modals/CommentEditModal')],\n    modules: ['components/Modals/CommentEditModal']\n  }\n});\nconst PostForm = dynamic(() => import('components/PostForm'), {\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('components/PostForm')],\n    modules: ['components/PostForm']\n  }\n});\nconst CommentForm = dynamic(() => import('components/CommentForm'), {\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('components/CommentForm')],\n    modules: ['components/CommentForm']\n  }\n});\n\nfunction Post({\n  singleCommunity,\n  communityUser\n}) {\n  const dispatch = useDispatch();\n  const {\n    mainPosts,\n    hasMorePost,\n    loadPostsLoading,\n    updateCommentDone\n  } = useSelector(state => state.post);\n  const {\n    0: editMode,\n    1: setEditMode\n  } = useState(false);\n  const {\n    0: showPostSettingButton,\n    1: setShowPostSettingButton\n  } = useState(false); // 포스트설정 모달 보여주기\n\n  const {\n    0: CurrentPostSettingButton,\n    1: setCurrentPostSettingButton\n  } = useState(0); // 현재 보여지고 있는 포스트설정 모달\n\n  const {\n    0: currentModifyPost,\n    1: setCurrentModifyPost\n  } = useState(0); // 현재 수정중인 포스트\n\n  const {\n    0: showCommentSettingButton,\n    1: setShowCommentSettingButton\n  } = useState(false);\n  const {\n    0: currentCommentSettingButton,\n    1: setCurrentCommentSettingButton\n  } = useState(0);\n  const {\n    0: currentModifyComment,\n    1: setCurrentModifyComment\n  } = useState(0);\n  const {\n    0: openPostCommentForm,\n    1: setOpenPostCommentForm\n  } = useState(false);\n  const {\n    0: currentPostCommentForm,\n    1: setCurrentPostCommentForm\n  } = useState(0);\n  const postContainerRef = useRef(null);\n  const onClickPostSettingButton = useCallback(postId => () => {\n    setCurrentPostSettingButton(postId);\n    setShowPostSettingButton(true);\n  }, []);\n  const onClickCommentSettingButton = useCallback(commentId => () => {\n    setCurrentCommentSettingButton(commentId);\n    setShowCommentSettingButton(true);\n  }, []);\n  const onTogglePostCommentForm = useCallback(postId => () => {\n    setCurrentPostCommentForm(postId);\n    setOpenPostCommentForm(prev => !prev);\n  }, []);\n  const onCloseSettingModal = useCallback(() => {\n    if (showPostSettingButton || showCommentSettingButton) {\n      setShowPostSettingButton(false);\n      setShowCommentSettingButton(false);\n    }\n  }, [showPostSettingButton, showCommentSettingButton]);\n  useEffect(() => {\n    if (updateCommentDone) {\n      setEditMode(false);\n    }\n  }, [updateCommentDone]);\n  useEffect(() => {\n    const postContainer = postContainerRef.current;\n    if (!postContainer) return;\n\n    function onScroll(e) {\n      if (communityUser && mainPosts.length) {\n        if (e.target.scrollTop >= e.target.scrollHeight - e.target.offsetHeight - 300) {\n          if (hasMorePost && !loadPostsLoading) {\n            const lastId = mainPosts[mainPosts.length - 1].id;\n            dispatch(loadPostsRequestAction({\n              communityId: singleCommunity.id,\n              postId: lastId\n            }));\n          }\n        }\n      }\n    }\n\n    postContainer.addEventListener('scroll', onScroll);\n    return () => postContainer.removeEventListener('scroll', onScroll);\n  }, [communityUser, mainPosts, hasMorePost, loadPostsLoading, singleCommunity, postContainerRef.current]);\n  return /*#__PURE__*/_jsx(PostContainer, {\n    onClick: onCloseSettingModal,\n    ref: postContainerRef,\n    children: communityUser ? /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"post-form-container\",\n        children: /*#__PURE__*/_jsx(PostForm, {})\n      }), mainPosts.length ? /*#__PURE__*/_jsx(_Fragment, {\n        children: mainPosts.map(post => /*#__PURE__*/_jsxs(\"div\", {\n          className: \"post-body-container\",\n          children: [editMode && post.id === currentModifyPost && /*#__PURE__*/_jsx(PostEditModal, {\n            setEditMode: setEditMode,\n            setCurrentModifyPost: setCurrentModifyPost,\n            currentPostText: post.content,\n            postId: post.id,\n            communityId: singleCommunity.id\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"header post-body-header\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"header-left\",\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                children: post.User.profilePhoto ? /*#__PURE__*/_jsx(\"img\", {\n                  className: \"left-profile-image\",\n                  src: post.User.profilePhoto,\n                  alt: \"profile image\"\n                }) : /*#__PURE__*/_jsx(\"div\", {\n                  className: \"left-fake-image\",\n                  children: post.User.nickname[0]\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"left-nickname\",\n                children: post.User.nickname\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"header-right\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"right-day\",\n                children: moment(post.createdAt).locale('ko').format('LLL')\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"right-buttons\",\n                onClick: onClickPostSettingButton(post.id),\n                children: /*#__PURE__*/_jsx(MoreOutlined, {})\n              }), showPostSettingButton && post.id === CurrentPostSettingButton && /*#__PURE__*/_jsx(PostSettingModal, {\n                setCurrentModifyPost: setCurrentModifyPost,\n                setEditMode: setEditMode,\n                postId: post.id,\n                communityId: singleCommunity.id,\n                postOwnerId: post.User.id,\n                communityUserId: communityUser.id,\n                content: post.content\n              })]\n            })]\n          }), post.Images.length ? /*#__PURE__*/_jsx(\"img\", {\n            src: post.Images[0].src.replace(/\\/resize\\//, '/original/'),\n            alt: \"image\",\n            className: \"post-image\"\n          }) : null, /*#__PURE__*/_jsx(\"div\", {\n            className: \"post-text\",\n            children: post.content\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"post-comment-info\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              onClick: onTogglePostCommentForm(post.id),\n              style: {\n                cursor: 'pointer'\n              },\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                style: {\n                  marginRight: '4px'\n                },\n                children: /*#__PURE__*/_jsx(MessageOutlined, {})\n              }), post.Comments.length ? `댓글 ${post.Comments.length}개 모두보기` : '댓글 작성하기']\n            }), openPostCommentForm && currentPostCommentForm === post.id && /*#__PURE__*/_jsxs(_Fragment, {\n              children: [post.Comments && post.Comments.map(comment => /*#__PURE__*/_jsxs(\"div\", {\n                className: \"post-comment-container\",\n                children: [editMode && comment.id === currentModifyComment && /*#__PURE__*/_jsx(CommentEditModal, {\n                  setEditMode: setEditMode,\n                  setCurrentModifyComment: setCurrentModifyComment,\n                  currentCommentText: comment.content,\n                  postId: post.id,\n                  commentId: comment.id\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"header comment-header\",\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    className: \"header-left\",\n                    children: [/*#__PURE__*/_jsx(\"span\", {\n                      children: comment.User.profilePhoto ? /*#__PURE__*/_jsx(\"img\", {\n                        className: \"left-profile-image\",\n                        src: comment.User.profilePhoto,\n                        alt: \"profile image\"\n                      }) : /*#__PURE__*/_jsx(\"div\", {\n                        className: \"left-fake-image\",\n                        children: comment.User.nickname[0]\n                      })\n                    }), /*#__PURE__*/_jsx(\"div\", {\n                      className: \"left-nickname\",\n                      children: comment.User.nickname\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"header-right\",\n                    children: [/*#__PURE__*/_jsx(\"div\", {\n                      className: \"right-day\",\n                      children: moment(comment.createdAt).locale('ko').format('LLL')\n                    }), /*#__PURE__*/_jsx(\"div\", {\n                      className: \"right-buttons\",\n                      onClick: onClickCommentSettingButton(comment.id),\n                      children: /*#__PURE__*/_jsx(MoreOutlined, {})\n                    })]\n                  }), showCommentSettingButton && comment.id === currentCommentSettingButton && /*#__PURE__*/_jsx(CommentSettingModal, {\n                    setCurrentModifyComment: setCurrentModifyComment,\n                    setEditMode: setEditMode,\n                    postId: post.id,\n                    commentId: comment.id,\n                    commentOwnerId: comment.User.id,\n                    communityUserId: communityUser.id,\n                    content: comment.content\n                  })]\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"comment-text\",\n                  children: comment.content\n                })]\n              }, comment.id)), /*#__PURE__*/_jsx(\"div\", {\n                className: \"post-comment-form-container\",\n                children: /*#__PURE__*/_jsx(CommentForm, {\n                  postId: post.id\n                })\n              })]\n            })]\n          })]\n        }, post.id))\n      }) : null]\n    }) : /*#__PURE__*/_jsx(\"div\", {\n      className: \"visitor-post\",\n      children: \"\\uCEE4\\uBBA4\\uB2C8\\uD2F0\\uC720\\uC800\\uB9CC \\uBCFC \\uC218 \\uC788\\uC2B5\\uB2C8\\uB2E4\"\n    })\n  });\n}\n\nexport default /*#__PURE__*/memo(Post);","map":{"version":3,"sources":["C:/Users/wlsdn/Desktop/frontend/react/next/community/front/components/CommunityBody/Post/index.tsx"],"names":["MessageOutlined","MoreOutlined","loadPostsRequestAction","moment","React","memo","useCallback","useEffect","useState","useRef","dynamic","useDispatch","useSelector","PostContainer","PostSettingModal","PostEditModal","CommentSettingModal","CommentEditModal","PostForm","CommentForm","Post","singleCommunity","communityUser","dispatch","mainPosts","hasMorePost","loadPostsLoading","updateCommentDone","state","post","editMode","setEditMode","showPostSettingButton","setShowPostSettingButton","CurrentPostSettingButton","setCurrentPostSettingButton","currentModifyPost","setCurrentModifyPost","showCommentSettingButton","setShowCommentSettingButton","currentCommentSettingButton","setCurrentCommentSettingButton","currentModifyComment","setCurrentModifyComment","openPostCommentForm","setOpenPostCommentForm","currentPostCommentForm","setCurrentPostCommentForm","postContainerRef","onClickPostSettingButton","postId","onClickCommentSettingButton","commentId","onTogglePostCommentForm","prev","onCloseSettingModal","postContainer","current","onScroll","e","length","target","scrollTop","scrollHeight","offsetHeight","lastId","id","communityId","addEventListener","removeEventListener","map","content","User","profilePhoto","nickname","createdAt","locale","format","Images","src","replace","cursor","marginRight","Comments","comment"],"mappings":"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","sourcesContent":["import { MessageOutlined, MoreOutlined } from '@ant-design/icons';\nimport { loadPostsRequestAction } from 'actions/actionPost';\nimport { ICommunity, IUserInfo } from 'interfaces/db';\nimport { RootStateInterface } from 'interfaces/RootState';\nimport moment from 'moment';\nimport React, { memo, useCallback, useEffect, useState, useRef } from 'react';\nimport dynamic from 'next/dynamic';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { PostContainer } from './styles';\n\nconst PostSettingModal = dynamic(() => import('components/Modals/PostSettingModal'));\nconst PostEditModal = dynamic(() => import('components/Modals/PostEditModal'));\nconst CommentSettingModal = dynamic(\n  () => import('components/Modals/CommentSettingModal')\n);\nconst CommentEditModal = dynamic(() => import('components/Modals/CommentEditModal'));\nconst PostForm = dynamic(() => import('components/PostForm'));\nconst CommentForm = dynamic(() => import('components/CommentForm'));\n\ninterface PostProps {\n  singleCommunity: ICommunity;\n  communityUser: IUserInfo | undefined;\n}\n\nfunction Post({ singleCommunity, communityUser }: PostProps) {\n  const dispatch = useDispatch();\n  const { mainPosts, hasMorePost, loadPostsLoading, updateCommentDone } = useSelector(\n    (state: RootStateInterface) => state.post\n  );\n  const [editMode, setEditMode] = useState(false);\n  const [showPostSettingButton, setShowPostSettingButton] = useState(false); // 포스트설정 모달 보여주기\n  const [CurrentPostSettingButton, setCurrentPostSettingButton] = useState(0); // 현재 보여지고 있는 포스트설정 모달\n  const [currentModifyPost, setCurrentModifyPost] = useState(0); // 현재 수정중인 포스트\n  const [showCommentSettingButton, setShowCommentSettingButton] = useState(false);\n  const [currentCommentSettingButton, setCurrentCommentSettingButton] = useState(0);\n  const [currentModifyComment, setCurrentModifyComment] = useState(0);\n  const [openPostCommentForm, setOpenPostCommentForm] = useState(false);\n  const [currentPostCommentForm, setCurrentPostCommentForm] = useState(0);\n  const postContainerRef = useRef<HTMLDivElement>(null);\n\n  const onClickPostSettingButton = useCallback(\n    (postId: number) => () => {\n      setCurrentPostSettingButton(postId);\n      setShowPostSettingButton(true);\n    },\n    []\n  );\n\n  const onClickCommentSettingButton = useCallback(\n    (commentId: number) => () => {\n      setCurrentCommentSettingButton(commentId);\n      setShowCommentSettingButton(true);\n    },\n    []\n  );\n\n  const onTogglePostCommentForm = useCallback(\n    (postId: number) => () => {\n      setCurrentPostCommentForm(postId);\n      setOpenPostCommentForm(prev => !prev);\n    },\n    []\n  );\n\n  const onCloseSettingModal = useCallback(() => {\n    if (showPostSettingButton || showCommentSettingButton) {\n      setShowPostSettingButton(false);\n      setShowCommentSettingButton(false);\n    }\n  }, [showPostSettingButton, showCommentSettingButton]);\n\n  useEffect(() => {\n    if (updateCommentDone) {\n      setEditMode(false);\n    }\n  }, [updateCommentDone]);\n\n  useEffect(() => {\n    const postContainer = postContainerRef.current;\n    if (!postContainer) return;\n\n    function onScroll(e: any) {\n      if (communityUser && mainPosts.length) {\n        if (e.target.scrollTop >= e.target.scrollHeight - e.target.offsetHeight - 300) {\n          if (hasMorePost && !loadPostsLoading) {\n            const lastId = mainPosts[mainPosts.length - 1].id;\n            dispatch(\n              loadPostsRequestAction({ communityId: singleCommunity.id, postId: lastId })\n            );\n          }\n        }\n      }\n    }\n\n    postContainer.addEventListener('scroll', onScroll);\n\n    return () => postContainer.removeEventListener('scroll', onScroll);\n  }, [\n    communityUser,\n    mainPosts,\n    hasMorePost,\n    loadPostsLoading,\n    singleCommunity,\n    postContainerRef.current,\n  ]);\n\n  return (\n    <PostContainer onClick={onCloseSettingModal} ref={postContainerRef}>\n      {communityUser ? (\n        <>\n          <div className=\"post-form-container\">\n            <PostForm />\n          </div>\n          {mainPosts.length ? (\n            <>\n              {mainPosts.map(post => (\n                <div className=\"post-body-container\" key={post.id}>\n                  {editMode && post.id === currentModifyPost && (\n                    <PostEditModal\n                      setEditMode={setEditMode}\n                      setCurrentModifyPost={setCurrentModifyPost}\n                      currentPostText={post.content}\n                      postId={post.id}\n                      communityId={singleCommunity.id}\n                    />\n                  )}\n                  <div className=\"header post-body-header\">\n                    <div className=\"header-left\">\n                      <span>\n                        {post.User.profilePhoto ? (\n                          <img\n                            className=\"left-profile-image\"\n                            src={post.User.profilePhoto}\n                            alt=\"profile image\"\n                          />\n                        ) : (\n                          <div className=\"left-fake-image\">{post.User.nickname[0]}</div>\n                        )}\n                      </span>\n                      <div className=\"left-nickname\">{post.User.nickname}</div>\n                    </div>\n                    <div className=\"header-right\">\n                      <div className=\"right-day\">\n                        {moment(post.createdAt).locale('ko').format('LLL')}\n                      </div>\n                      <div\n                        className=\"right-buttons\"\n                        onClick={onClickPostSettingButton(post.id)}\n                      >\n                        <MoreOutlined />\n                      </div>\n                      {showPostSettingButton && post.id === CurrentPostSettingButton && (\n                        <PostSettingModal\n                          setCurrentModifyPost={setCurrentModifyPost}\n                          setEditMode={setEditMode}\n                          postId={post.id}\n                          communityId={singleCommunity.id}\n                          postOwnerId={post.User.id}\n                          communityUserId={communityUser.id}\n                          content={post.content}\n                        />\n                      )}\n                    </div>\n                  </div>\n                  {post.Images.length ? (\n                    <img\n                      src={post.Images[0].src.replace(/\\/resize\\//, '/original/')}\n                      alt=\"image\"\n                      className=\"post-image\"\n                    />\n                  ) : null}\n                  <div className=\"post-text\">{post.content}</div>\n                  <div className=\"post-comment-info\">\n                    <div\n                      onClick={onTogglePostCommentForm(post.id)}\n                      style={{\n                        cursor: 'pointer',\n                      }}\n                    >\n                      <span style={{ marginRight: '4px' }}>\n                        <MessageOutlined />\n                      </span>\n                      {post.Comments.length\n                        ? `댓글 ${post.Comments.length}개 모두보기`\n                        : '댓글 작성하기'}\n                    </div>\n                    {openPostCommentForm && currentPostCommentForm === post.id && (\n                      <>\n                        {post.Comments &&\n                          post.Comments.map(comment => (\n                            <div className=\"post-comment-container\" key={comment.id}>\n                              {editMode && comment.id === currentModifyComment && (\n                                <CommentEditModal\n                                  setEditMode={setEditMode}\n                                  setCurrentModifyComment={setCurrentModifyComment}\n                                  currentCommentText={comment.content}\n                                  postId={post.id}\n                                  commentId={comment.id}\n                                />\n                              )}\n                              <div className=\"header comment-header\">\n                                <div className=\"header-left\">\n                                  <span>\n                                    {comment.User.profilePhoto ? (\n                                      <img\n                                        className=\"left-profile-image\"\n                                        src={comment.User.profilePhoto}\n                                        alt=\"profile image\"\n                                      />\n                                    ) : (\n                                      <div className=\"left-fake-image\">\n                                        {comment.User.nickname[0]}\n                                      </div>\n                                    )}\n                                  </span>\n                                  <div className=\"left-nickname\">\n                                    {comment.User.nickname}\n                                  </div>\n                                </div>\n                                <div className=\"header-right\">\n                                  <div className=\"right-day\">\n                                    {moment(comment.createdAt).locale('ko').format('LLL')}\n                                  </div>\n                                  <div\n                                    className=\"right-buttons\"\n                                    onClick={onClickCommentSettingButton(comment.id)}\n                                  >\n                                    <MoreOutlined />\n                                  </div>\n                                </div>\n                                {showCommentSettingButton &&\n                                  comment.id === currentCommentSettingButton && (\n                                    <CommentSettingModal\n                                      setCurrentModifyComment={setCurrentModifyComment}\n                                      setEditMode={setEditMode}\n                                      postId={post.id}\n                                      commentId={comment.id}\n                                      commentOwnerId={comment.User.id}\n                                      communityUserId={communityUser.id}\n                                      content={comment.content}\n                                    />\n                                  )}\n                              </div>\n                              <div className=\"comment-text\">{comment.content}</div>\n                            </div>\n                          ))}\n                        <div className=\"post-comment-form-container\">\n                          <CommentForm postId={post.id} />\n                        </div>\n                      </>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </>\n          ) : null}\n        </>\n      ) : (\n        <div className=\"visitor-post\">커뮤니티유저만 볼 수 있습니다</div>\n      )}\n    </PostContainer>\n  );\n}\n\nexport default memo(Post);\n"]},"metadata":{},"sourceType":"module"}